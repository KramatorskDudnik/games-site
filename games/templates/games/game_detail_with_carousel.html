{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Навигация -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Главная</a></li>
            <li class="breadcrumb-item active">{{ game.title }}</li>
        </ol>
    </nav>
    
    <div class="row">
        <!-- Левый блок: Карусель изображений -->
        <div class="col-lg-7">
            <div class="card mb-4">
                <div class="card-body">
                    {% if game.images.all %}
                    <!-- Карусель Bootstrap -->
                    <div id="gameCarousel" class="carousel slide" data-bs-ride="carousel">
                        <!-- Индикаторы -->
                        <div class="carousel-indicators">
                            {% for image in game.images.all %}
                            <button type="button" data-bs-target="#gameCarousel" 
                                    data-bs-slide-to="{{ forloop.counter0 }}" 
                                    class="{% if forloop.first %}active{% endif %}"
                                    aria-label="Slide {{ forloop.counter }}"></button>
                            {% endfor %}
                        </div>
                        
                        <!-- Слайды -->
                        <div class="carousel-inner">
                            {% for image in game.images.all %}
                            <div class="carousel-item {% if forloop.first %}active{% endif %}">
                                <img src="{{ image.image.url }}" 
                                     class="d-block w-100 rounded" 
                                     alt="{{ image.caption|default:game.title }}"
                                     style="max-height: 400px; object-fit: contain; background-color: #f8f9fa;">
                                
                                {% if image.caption %}
                                <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-2">
                                    <p class="mb-0">{{ image.caption }}</p>
                                </div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                        
                        <!-- Кнопки управления -->
                        <button class="carousel-control-prev" type="button" data-bs-target="#gameCarousel" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Предыдущий</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#gameCarousel" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Следующий</span>
                        </button>
                    </div>
                    
                    <!-- Миниатюры -->
                    <div class="row mt-3">
                        {% for image in game.images.all %}
                        <div class="col-3 col-md-2 mb-2">
                            <a href="#" class="thumbnail-link" data-slide-to="{{ forloop.counter0 }}">
                                <img src="{{ image.image.url }}" 
                                     class="img-thumbnail {% if forloop.first %}active{% endif %}" 
                                     alt="{{ image.caption|default:game.title }}"
                                     style="height: 60px; width: 100%; object-fit: cover; cursor: pointer;">
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <!-- Если нет изображений -->
                    <div class="text-center py-5 bg-light rounded">
                        <i class="fas fa-image fa-4x text-muted mb-3"></i>
                        <h4>Нет изображений</h4>
                        <p class="text-muted">Изображения для этой игры пока не добавлены</p>
                        <a href="/admin/games/gameimage/add/?game={{ game.id }}" 
                           target="_blank" 
                           class="btn btn-outline-primary mt-2">
                            <i class="fas fa-plus me-1"></i>Добавить первое фото
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Правый блок: Информация об игре -->
        <div class="col-lg-5">
            <div class="card mb-4">
                <div class="card-body">
                    <h1 class="card-title">{{ game.title }}</h1>
                    
                    <!-- Основная информация -->
                    <div class="game-info mb-4">
                        {% if game.min_players or game.max_players %}
                        <div class="info-item mb-2">
                            <i class="fas fa-users fa-fw text-primary me-2"></i>
                            <strong>Количество игроков:</strong>
                            {% if game.min_players and game.max_players %}
                                {{ game.min_players }}-{{ game.max_players }}
                            {% elif game.min_players %}
                                от {{ game.min_players }}
                            {% else %}
                                до {{ game.max_players }}
                            {% endif %}
                        </div>
                        {% endif %}
                        
                        {% if game.playtime_minutes %}
                        <div class="info-item mb-2">
                            <i class="fas fa-clock fa-fw text-success me-2"></i>
                            <strong>Время игры:</strong> {{ game.playtime_minutes }} минут
                        </div>
                        {% endif %}
                        
                        {% if game.difficulty %}
                        <div class="info-item mb-2">
                            <i class="fas fa-brain fa-fw text-warning me-2"></i>
                            <strong>Сложность:</strong> 
                            <span class="difficulty-stars">
                                {% for i in "12345" %}
                                    {% if forloop.counter <= game.difficulty %}
                                        <i class="fas fa-star text-warning"></i>
                                    {% else %}
                                        <i class="far fa-star text-warning"></i>
                                    {% endif %}
                                {% endfor %}
                                ({{ game.difficulty }}/5)
                            </span>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Описание -->
                    {% if game.description %}
                    <div class="mb-4">
                        <h5><i class="fas fa-align-left me-2"></i>Описание</h5>
                        <p class="card-text">{{ game.description|linebreaks }}</p>
                    </div>
                    {% endif %}
                    
                    <!-- Ссылки -->
                    <div class="game-links">
                        {% if game.rules_link %}
                        <a href="{{ game.rules_link }}" target="_blank" class="btn btn-outline-primary me-2 mb-2">
                            <i class="fas fa-book me-1"></i>Правила игры
                        </a>
                        {% endif %}
                        
                        {% if game.video_link %}
                        <a href="{{ game.video_link }}" target="_blank" class="btn btn-outline-danger me-2 mb-2">
                            <i class="fas fa-video me-1"></i>Обзор на YouTube
                        </a>
                        {% endif %}
                        
                        <a href="/admin/games/game/{{ game.id }}/change/" target="_blank" class="btn btn-outline-secondary mb-2">
                            <i class="fas fa-edit me-1"></i>Редактировать игру
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Быстрая статистика -->
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title"><i class="fas fa-chart-bar me-2"></i>Быстрая информация</h5>
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="p-2">
                                <div class="fs-4 text-primary">
                                    {% if game.min_players %}{{ game.min_players }}{% else %}?{% endif %}
                                </div>
                                <small>Мин. игроков</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="p-2">
                                <div class="fs-4 text-success">
                                    {% if game.playtime_minutes %}{{ game.playtime_minutes }}{% else %}?{% endif %}
                                </div>
                                <small>Минут</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="p-2">
                                <div class="fs-4 text-warning">
                                    {% if game.difficulty %}{{ game.difficulty }}/5{% else %}?{% endif %}
                                </div>
                                <small>Сложность</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.carousel-item img {
    background-color: #f8f9fa;
    padding: 20px;
}

.thumbnail-link {
    opacity: 0.6;
    transition: opacity 0.3s;
    display: block;
}

.thumbnail-link:hover, .thumbnail-link.active {
    opacity: 1;
}

.info-item {
    padding: 8px 0;
    border-bottom: 1px solid #eee;
}

.difficulty-stars {
    display: inline-block;
}

.game-links .btn {
    min-width: 160px;
}

.card {
    border: none;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
</style>

<script>
// Клик по миниатюрам для переключения слайдов
document.querySelectorAll('.thumbnail-link').forEach((link, index) => {
    link.addEventListener('click', function(e) {
        e.preventDefault();
        const carousel = new bootstrap.Carousel(document.getElementById('gameCarousel'));
        carousel.to(index);
        
        // Обновляем активную миниатюру
        document.querySelectorAll('.thumbnail-link').forEach(l => {
            l.querySelector('img').classList.remove('active');
        });
        this.querySelector('img').classList.add('active');
    });
});
</script>
{% endblock %}
